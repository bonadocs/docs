"use strict";(self.webpackChunkbonadocs_docs=self.webpackChunkbonadocs_docs||[]).push([[155],{5599:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=t(4848),s=t(8453);const o={sidebar_position:2},a="Actions",i={id:"guides/Playground/Contracts/Action",title:"Actions",description:"Actions allow us to interact with our contracts using a JavaScript environment; similar to the front end of an application. Multiple smart contract method calls and transactions are required to complete certain complex actions. For example, executing a Swap action on Uniswap involves at least two calls for most tokens: approve tokens (approve), and execute swap (swapExactTokensForTokens). Actions allow us to complete these kinds of interactions on smart contracts.",source:"@site/docs/guides/Playground/Contracts/Action.md",sourceDirName:"guides/Playground/Contracts",slug:"/guides/Playground/Contracts/Action",permalink:"/docs/guides/Playground/Contracts/Action",draft:!1,unlisted:!1,editUrl:"https://github.com/bonadocs/docs/docs/guides/Playground/Contracts/Action.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Contract Methods",permalink:"/docs/guides/Playground/Contracts/Contract-methods"},next:{title:"Variables",permalink:"/docs/guides/Playground/Variables"}},c={},d=[{value:"Built-in Variables",id:"built-in-variables",level:2},{value:"Simulation Engine",id:"simulation-engine",level:2},{value:"<code>Buildbear</code>",id:"buildbear",level:3},{value:"<code>Tenderly virtual Testnet</code>",id:"tenderly-virtual-testnet",level:3},{value:"<code>Zimulatoor</code>",id:"zimulatoor",level:3},{value:"<code>Direct Mainnet/Testnet Interaction</code>",id:"direct-mainnettestnet-interaction",level:3},{value:"Self",id:"self",level:2},{value:"Packages",id:"packages",level:2},{value:"Run Your Action",id:"run-your-action",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"actions",children:"Actions"}),"\n",(0,r.jsxs)(n.p,{children:["Actions allow us to interact with our contracts using a JavaScript environment; similar to the front end of an application. Multiple smart contract method calls and transactions are required to complete certain complex actions. For example, executing a Swap action on Uniswap involves at least two calls for most tokens: approve tokens (",(0,r.jsx)(n.code,{children:"approve"}),"), and execute swap (",(0,r.jsx)(n.code,{children:"swapExactTokensForTokens"}),"). Actions allow us to complete these kinds of interactions on smart contracts."]}),"\n",(0,r.jsxs)(n.p,{children:["To create an action, click on the ",(0,r.jsx)(n.code,{children:"Add"})," icon as shown below:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://res.cloudinary.com/dfkuxnesz/image/upload/v1728658794/Screenshot_2024-10-11_at_15.52.40_arpijl.png",alt:"Action creation"})}),"\n",(0,r.jsxs)(n.p,{children:["Add your action ",(0,r.jsx)(n.code,{children:"name"})," and select the ",(0,r.jsx)(n.code,{children:"network"})," you want to run your actions on. The ",(0,r.jsx)(n.code,{children:"network"})," you select is determined by which networks your contracts are deployed on."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://res.cloudinary.com/dfkuxnesz/image/upload/v1728658675/Screenshot_2024-10-11_at_15.53.25_ktdwux.png",alt:"Actions"})}),"\n",(0,r.jsx)(n.h2,{id:"built-in-variables",children:"Built-in Variables"}),"\n",(0,r.jsx)(n.p,{children:"We have certain built-in variables that allow developers to access and initialize their contracts, etc."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://res.cloudinary.com/dfkuxnesz/image/upload/v1728658945/Screenshot_2024-10-11_at_16.02.09_ilteg3.png",alt:"Actions code"})}),"\n",(0,r.jsx)(n.p,{children:"The most used built-in variables includes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ethers variables (",(0,r.jsx)(n.code,{children:"parseUnits"}),", ",(0,r.jsx)(n.code,{children:"formatUnits"}),", ",(0,r.jsx)(n.code,{children:"ZeroAddress"}),", etc)."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const { Contract, formatUnits, parseUnits, BigNumber, ZeroAddress } = ethers;\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Viem Support",type:"info",children:(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Support for the ",(0,r.jsx)(n.a,{href:"https://viem.sh/",children:"viem"})," library is still in development."]})})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bonadocs.contracts"}),": This contains all the contracts inside the playground.\nIn the example below, we want to use the ",(0,r.jsx)(n.code,{children:"SablierV2LockupLinear"})," contract in our playground."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const { address: sablierV2LockupLinearAddress, abi: sablierV2LockupLinearAbi } =\n  bonadocs.contracts.SablierV2LockupLinear;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Once you add your contracts, you can destructure it to get the address, and ABI of the contract. Similarly, you can also get the ",(0,r.jsx)(n.code,{children:"chainId"})," and ",(0,r.jsx)(n.code,{children:"name"})," of the contract."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bonadocs.commonAbis.erc20"}),": basic ",(0,r.jsx)(n.code,{children:"erc20"})," abi in a format supported by ",(0,r.jsx)(n.code,{children:"ethers"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const erc20Abi = bonadocs.commonAbis.erc20;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"simulation-engine",children:"Simulation Engine"}),"\n",(0,r.jsx)(n.p,{children:"Actions use simulation engines to enable to run within the playground. The reason is that this allows developers to get access to a provider and signer for contract interaction without connecting an actual wallet. Currently, we support  the following simulators:"}),"\n",(0,r.jsx)(n.h3,{id:"buildbear",children:(0,r.jsx)(n.code,{children:"Buildbear"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.buildbear.io/",children:"Buildbear"})," is a simulation engine that allows you to fork your preferred network and gives you access to a faucet, RPC URL, explorer, etc for your forked network. This allows you to interact with your contract within our controlled action environment."]}),"\n",(0,r.jsxs)(n.p,{children:["The code template below creates a new wallet with ",(0,r.jsx)(n.code,{children:"ethers"}),", funds it with gas fees, and the preferred token for the transaction. Then, it makes the provider and signer available for the actual transaction. You'll have to go to ",(0,r.jsx)(n.a,{href:"https://www.buildbear.io/",children:"Buildbear"})," to get your network's RPC URL."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// \u26a0\ufe0f Write action in Javascript\n// \u26a0\ufe0f Make sure to replace the BUILDBEAR_RPC_URL and CONTRACT_ADDRESS_OF_TOKEN_ON_NETWORK with the actual values for your BuildBear simulation environment\n\nconst { Contract, formatUnits, parseUnits, BigNumber, ZeroAddress, Mnemonic, Wallet } = ethers;\n// const { address, abi } = bonadocs.contracts.{CONTRACT_NAME};\nconst BUILDBEAR_RPC_URL = \'\';\nconst CONTRACT_ADDRESS_OF_TOKEN_ON_NETWORK = \'\'; // Replace with the actual contract address of the token you want to fund\nconst provider = new ethers.JsonRpcProvider(BUILDBEAR_RPC_URL);\nconst signer = Wallet.fromPhrase(Mnemonic.fromEntropy(ethers.randomBytes(24)).phrase, provider);\nconst blockNumber = await provider.getBlockNumber();\nconsole.log(blockNumber);\n\nawait(async () => {\n    try {\n        // Funding the created wallet with gas fees \n        await fetch(BUILDBEAR_RPC_URL, {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n                jsonrpc: "2.0",\n                id: 1,\n                method: "buildbear_nativeFaucet",\n                params: [\n                    {\n                        address: signer.address,\n                        balance: "10000000000000000000",\n                        unit: "wei"\n                    }\n                ]\n            })\n        }\n\n        )\n\n        // Fund any ERC20 token using buildbear_ERC20Faucet\n        await fetch(BUILDBEAR_RPC_URL, {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n                jsonrpc: "2.0",\n                id: 1,\n                method: "buildbear_ERC20Faucet",\n                params: [\n                    {\n                        address: signer.address,\n                        balance: "10000000000000000000",\n                        token: CONTRACT_ADDRESS_OF_TOKEN_ON_NETWORK,\n                        unit: "wei"\n                    }\n                ]\n            })\n        })\n\n    } catch (err) {\n\n        console.log(err)\n    }\n\n})();\n\n// Initiate your contracts (bonadocs.contracts) with the signer\n\n// const contractName = new Contract(\n//     address,\n//     abi,\n//     signer,\n// );\n'})}),"\n",(0,r.jsx)(n.h3,{id:"tenderly-virtual-testnet",children:(0,r.jsx)(n.code,{children:"Tenderly virtual Testnet"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://docs.tenderly.co/virtual-testnets",children:"Tenderly virtual testnet"})," is a simulation engine by ",(0,r.jsx)(n.a,{href:"https://tenderly.co/",children:"tenderly"})," that allows you to fork your preferred network and gives you access to a faucet, RPC URL, explorer, etc for your forked network. This allows you to interact with your contract within our controlled action environment."]}),"\n",(0,r.jsxs)(n.p,{children:["The code template below creates a new wallet with ",(0,r.jsx)(n.code,{children:"ethers"}),", funds it with gas fees, and the preferred token for the transaction. Then, it makes the provider and signer available for the actual transaction. You'll have to go to ",(0,r.jsx)(n.a,{href:"https://tenderly.co/",children:"Tenderly"})," to get your network's RPC URL."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// \u26a0\ufe0f Write action in Javascript\n// \u26a0\ufe0f Make sure to replace the TENDERLY_RPC_URL, USDC_CONTRACT_ADDRESS, and USDC_DECIMALS with the actual values for your Tenderly simulation environment\n\nconst { Contract, formatUnits, parseUnits, BigNumber, ZeroAddress, Mnemonic, Wallet } = ethers;\nconst TENDERLY_RPC_URL = "";\nconst USDC_CONTRACT_ADDRESS = ""; // Replace with the actual contract address of your token on the network\n// const { address, abi } = bonadocs.contracts.{CONTRACT_NAME}; // Replace with the actual contract name\nconst provider = new ethers.JsonRpcProvider(TENDERLY_RPC_URL);\nconst signer = Wallet.fromPhrase(Mnemonic.fromEntropy(ethers.randomBytes(24)).phrase, provider);\n\nawait(async () => {\n    // Funding the created wallet with gas fees \n    await provider.send("tenderly_setBalance", [\n        signer.address,\n        "0xDE0B6B3A7640000",  // ~1 ETH for gas fees\n    ]);\n\n    const USDC_DECIMALS = 6;\n    // Fund with USDC using tenderly_setErc20Balance\n    const usdcAmount = "1000"; // 1000 USDC (Replace with the actual decimals of your token on the network)\n    const usdcAmountWei = ethers.parseUnits(usdcAmount, USDC_DECIMALS);\n\n    await provider.send("tenderly_setErc20Balance", [\n        USDC_CONTRACT_ADDRESS,\n        signer.address,\n        ethers.toBeHex(usdcAmountWei)\n    ]);\n\n})();\n// Initiate your contracts (bonadocs.contracts) with the signer\n// const contractName = new Contract(\n//     address,\n//     abi,\n//     signer,\n// );\n'})}),"\n",(0,r.jsx)(n.h3,{id:"zimulatoor",children:(0,r.jsx)(n.code,{children:"Zimulatoor"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SimulationProvider"})," from ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@bonadocs/zimulatoor",children:"zimulatoor"}),". It's our native simulation engine that allows us to create simulated signers for any address, which is used to initialize the contracts and make queries. It creates a simulated provider for any wallet and doesn't require you to bring in a new wallet private key."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const { SimulationProvider } = zimulatoor;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["When we use them together, we create the ",(0,r.jsx)(n.code,{children:"provider"})," using the ",(0,r.jsx)(n.code,{children:"chainId"}),". Then, we use the ",(0,r.jsx)(n.code,{children:"provider.getImpersonatedSigner()"})," to create the signer (",(0,r.jsx)(n.code,{children:"wealthySigner"}),") for our ",(0,r.jsx)(n.code,{children:"wealthyAddress"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"sablier"})," contract is now initiated using:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"sablierV2LockupLinearAddress"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"sablierV2LockupLinearAbi"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"wealthySigner"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const { Contract, formatUnits, parseUnits, BigNumber, ZeroAddress } = ethers;\n\nconst { address: sablierV2LockupLinearAddress, abi: sablierV2LockupLinearAbi } =\n  bonadocs.contracts.SablierV2LockupLinear;\nconst chainId = 1;\nconst provider = new SimulationProvider(chainId);\nconst wealthyAddress = "0x1eED63EfBA5f81D95bfe37d82C8E736b974F477b";\n\nconst wealthySigner = await provider.getImpersonatedSigner(wealthyAddress);\nconst sablier = new Contract(\n  sablierV2LockupLinearAddress,\n  sablierV2LockupLinearAbi,\n  wealthySigner\n);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Once we initiate the ",(0,r.jsx)(n.code,{children:"sablier"})," contract, we can now use it to query methods. Below, we use it to query the ",(0,r.jsx)(n.code,{children:"createWithDurations"})," method."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'try {\n  const streamTx = await sablier.createWithDurations([\n    wealthyAddress,\n    recipientAddress,\n    amountStreamed,\n    daiTokenAddress,\n    true,\n    true,\n    [BigInt(23456), BigInt(31449600)],\n    [ZeroAddress, 0n],\n  ]);\n\n  const streamRct = await streamTx.wait();\n\n  const streamLog = streamRct.logs.find(\n    (l) => l.fragment?.name === "CreateLockupLinearStream"\n  );\n\n  console.log("emittedStream", {\n    streamId: streamLog.args.streamId,\n    sender: streamLog.args.sender,\n    recipient: streamLog.args.recipient,\n    amounts: streamLog.args.amounts,\n    asset: streamLog.args.asset,\n    cancelable: streamLog.args.cancelable,\n    transferable: streamLog.args.transferable,\n    timestamps: streamLog.args.timestamps,\n    broker: streamLog.args.broker,\n  });\n\n  streamId = streamLog.args.streamId;\n} catch (error) {\n  parseEthersError(error, sablier);\n  console.error(error);\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["P.S: We make use of ",(0,r.jsx)(n.code,{children:"parseEthersError"})," to properly parse errors. It's built into the action code environment; not imported from ",(0,r.jsx)(n.code,{children:"ethers"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"direct-mainnettestnet-interaction",children:(0,r.jsx)(n.code,{children:"Direct Mainnet/Testnet Interaction"})}),"\n",(0,r.jsx)(n.p,{children:"Developers can also interact with their contracts over mainnet or testnet. They would have to bring in their private key and funded address into the actions."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// \u26a0\ufe0f Write action in Javascript\nconst { Contract, formatUnits, parseUnits, BigNumber, ZeroAddress, Mnemonic, Wallet } = ethers;\n\nconst TESTNET_RPC_URL = ''; // Replace with your RPC URL\nconst PRIVATE_KEY = ''; // Replace with your actual private key\n// const { address, abi } = bonadocs.contracts.{CONTRACT_NAME}; // Replace with the actual contract name\n\n// Initialize provider\nconst provider = new ethers.JsonRpcProvider(TESTNET_RPC_URL);\n\n// Method 1: Create wallet (which is a signer) with provider\nconst wallet = new Wallet(PRIVATE_KEY, provider);\nconst signer = wallet; // wallet IS a signer\n\n\n// Initiate your contracts (bonadocs.contracts) with the signer\n// const contractName = new Contract(\n//     address,\n//     abi,\n//     signer,\n// );\n"})}),"\n",(0,r.jsx)(n.h2,{id:"self",children:"Self"}),"\n",(0,r.jsxs)(n.p,{children:["Actions run in a dedicated worker in the browser, so they can access any browser API using ",(0,r.jsx)(n.code,{children:"self"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["In the example below, we use ",(0,r.jsx)(n.code,{children:"self.crypto"})," the same way you use ",(0,r.jsx)(n.code,{children:"window.crypto"})," in your browser."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:" const encrypted = await self.crypto.subtle.encrypt(\n    {\n      name: 'RSA-OAEP'\n    },\n    publicKey: CryptoKey,\n    dataBuffer: Uint8Array\n  );\n"})}),"\n",(0,r.jsx)(n.h2,{id:"packages",children:"Packages"}),"\n",(0,r.jsx)(n.admonition,{title:"Packages Information",type:"info",children:(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Our package feature is experimental and doesn't yet cover all package importation edge cases. We recommend that developers use native JS and browser APIs over importing packages into the actions environment."})})}),"\n",(0,r.jsxs)(n.p,{children:["You can add custom NPM packages to your actions. Click on ",(0,r.jsx)(n.code,{children:"Packages"})," and the ",(0,r.jsx)(n.code,{children:"Add"})," icon below"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://res.cloudinary.com/dfkuxnesz/image/upload/v1728659304/Screenshot_2024-10-11_at_16.05.35_jdue6u.png",alt:"Add Packages"})}),"\n",(0,r.jsxs)(n.p,{children:["After which, you search for your preferred package and click on the ",(0,r.jsx)(n.code,{children:"Add Package"})," button."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://res.cloudinary.com/dfkuxnesz/image/upload/v1728659304/Screenshot_2024-10-11_at_16.07.02_k9e4dn.png",alt:"Add Packages"})}),"\n",(0,r.jsxs)(n.p,{children:["This opens up a modal to select the version that you need. Finally, click ",(0,r.jsx)(n.code,{children:"Download"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://res.cloudinary.com/dfkuxnesz/image/upload/v1728659306/Screenshot_2024-10-11_at_16.07.47_zotdiy.png",alt:"Package version"})}),"\n",(0,r.jsxs)(n.p,{children:["Here's how you make use of the package inside your action. In this case, ",(0,r.jsx)(n.code,{children:"lodash"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const _ = require("lodash");\n\nconst object1 = { a: 1, b: { c: 2 } };\nconst object2 = { a: 1, b: { c: 2 } };\n\nconst areObjectsEqual = _.isEqual(object1, object2);\n\nconsole.log(areObjectsEqual);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["P.S: Only packages with ",(0,r.jsx)(n.code,{children:"esm"})," modules need the ",(0,r.jsx)(n.code,{children:"require"})," function to get the module data. ",(0,r.jsx)(n.code,{children:"umd"})," modules are accessible directly with the global object added by the module, i.e, ",(0,r.jsx)(n.code,{children:"ethers"})," above."]}),"\n",(0,r.jsx)(n.p,{children:"You can also use your package's CDN link to quickly use it within the action."}),"\n",(0,r.jsx)(n.h2,{id:"run-your-action",children:"Run Your Action"}),"\n",(0,r.jsxs)(n.p,{children:["Click on the ",(0,r.jsx)(n.code,{children:"Run"})," button below and you'll get your response on the right."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://res.cloudinary.com/dfkuxnesz/image/upload/v1728709605/Screenshot_2024-10-12_at_06.05.37_ubae6g.png",alt:"Action"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(6540);const s={},o=r.createContext(s);function a(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);